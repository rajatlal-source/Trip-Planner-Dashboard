import React, { useState, useEffect } from 'react';
import { Calendar, MapPin, Car, Hotel, DollarSign, Clock, Info, Star, Camera, Mountain, Droplets, Edit, Save, Plus, Trash2, PieChart, TrendingUp, Users, Plane } from 'lucide-react';

const MeghalayaTripPlanner = () => {
  // Initial data state
  const [tripData, setTripData] = useState({
    overview: {
      destination: "Meghalaya (+ Guwahati, Assam)",
      startDate: "2025-09-17",
      endDate: "2025-09-24",
      travelers: 2,
      currency: "‚Çπ"
    },
    budget: {
      accommodation: { estimated: 65000, actual: 0 },
      transport: { estimated: 31000, actual: 0 },
      food: { estimated: 19000, actual: 0 },
      activities: { estimated: 10000, actual: 0 },
      emergency: { estimated: 12500, actual: 0 }
    },
    itinerary: [
      {
        id: 1,
        date: "2025-09-17",
        title: "Arrival & Shillong",
        activities: {
          morning: "Fly into Guwahati ‚Üí Private cab to Shillong via Umiam Lake",
          afternoon: "Check-in; coffee at Dylan's / caf√© hop", 
          evening: "Stroll Ward's Lake & Police Bazar"
        },
        estimatedCost: 3500,
        actualCost: 0,
        notes: "GAU‚ÜíShillong ~102 km / ~2.5‚Äì3 hr"
      },
      {
        id: 2,
        date: "2025-09-18",
        title: "Shillong Exploration",
        activities: {
          morning: "Elephant Falls, Shillong Peak (if clear)",
          afternoon: "Laitlum Canyon viewpoint",
          evening: "Live music/caf√© scene"
        },
        estimatedCost: 2500,
        actualCost: 0,
        notes: "Laitlum is dramatic in monsoon"
      }
    ],
    hotels: [
      {
        id: 1,
        name: "Ri Kynjai Serenity by Lake",
        location: "Umiam Lake",
        category: "Premium",
        pricePerNight: 8500,
        nights: 4,
        checkIn: "2025-09-17",
        checkOut: "2025-09-21",
        bookingStatus: "Not booked",
        features: "Lake views, birthday dinner venue"
      },
      {
        id: 2,
        name: "Courtyard by Marriott Shillong",
        location: "Shillong City", 
        category: "Premium",
        pricePerNight: 7200,
        nights: 4,
        checkIn: "2025-09-17",
        checkOut: "2025-09-21",
        bookingStatus: "Not booked",
        features: "City center, modern amenities"
      }
    ],
    restaurants: [
      {
        id: 1,
        name: "Ukiyo",
        cuisine: "Pan-Asian Fusion",
        priceRange: "‚Çπ‚Çπ‚Çπ",
        estimatedCost: 2500,
        specialty: "Inventive cuisine with native Khasi ingredients",
        dayRecommended: 2,
        priority: "High"
      },
      {
        id: 2,
        name: "The Wok",
        cuisine: "Shillong-style Chinese",
        priceRange: "‚Çπ‚Çπ",
        estimatedCost: 800,
        specialty: "Local favorite for Chinese fare",
        dayRecommended: 1,
        priority: "High"
      }
    ]
  });

  const [activeTab, setActiveTab] = useState('dashboard');
  const [editMode, setEditMode] = useState({});

  // Load data from localStorage on mount
  useEffect(() => {
    const savedData = localStorage.getItem('meghalaya-trip-data');
    if (savedData) {
      try {
        setTripData(JSON.parse(savedData));
      } catch (error) {
        console.error('Error loading saved data:', error);
      }
    }
  }, []);

  // Save to localStorage whenever tripData changes
  useEffect(() => {
    localStorage.setItem('meghalaya-trip-data', JSON.stringify(tripData));
  }, [tripData]);

  const calculateTotalBudget = () => {
    return Object.values(tripData.budget).reduce((sum, item) => sum + item.estimated, 0);
  };

  const calculateActualSpent = () => {
    return Object.values(tripData.budget).reduce((sum, item) => sum + item.actual, 0);
  };

  const getDaysDifference = () => {
    const start = new Date(tripData.overview.startDate);
    const end = new Date(tripData.overview.endDate);
    return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
  };

  // Dashboard Component
  const renderDashboard = () => {
    const totalBudget = calculateTotalBudget();
    const actualSpent = calculateActualSpent();
    const remaining = totalBudget - actualSpent;
    const days = getDaysDifference();

    return (
      <div className="space-y-6">
        {/* Trip Overview Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-blue-100 text-sm">Total Budget</p>
                <p className="text-2xl font-bold">{tripData.overview.currency}{totalBudget.toLocaleString()}</p>
              </div>
              <DollarSign className="w-8 h-8 text-blue-200" />
            </div>
          </div>
          
          <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-green-100 text-sm">Remaining</p>
                <p className="text-2xl font-bold">{tripData.overview.currency}{remaining.toLocaleString()}</p>
              </div>
              <TrendingUp className="w-8 h-8 text-green-200" />
            </div>
          </div>

          <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-purple-100 text-sm">Duration</p>
                <p className="text-2xl font-bold">{days} days</p>
              </div>
              <Calendar className="w-8 h-8 text-purple-200" />
            </div>
          </div>

          <div className="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-orange-100 text-sm">Per Day Budget</p>
                <p className="text-2xl font-bold">{tripData.overview.currency}{Math.round(totalBudget/days).toLocaleString()}</p>
              </div>
              <Users className="w-8 h-8 text-orange-200" />
            </div>
          </div>
        </div>

        {/* Budget Breakdown Chart */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <PieChart className="w-5 h-5 mr-2 text-blue-600" />
            Budget Breakdown
          </h3>
          <div className="space-y-4">
            {Object.entries(tripData.budget).map(([category, data]) => {
              const percentage = (data.estimated / totalBudget) * 100;
              const spentPercentage = data.actual > 0 ? (data.actual / data.estimated) * 100 : 0;
              
              return (
                <div key={category} className="space-y-2">
                  <div className="flex justify-between items-center">
                    <span className="font-medium capitalize text-gray-700">{category}</span>
                    <div className="text-right">
                      <span className="text-sm text-gray-600">
                        {tripData.overview.currency}{data.actual.toLocaleString()} / {tripData.overview.currency}{data.estimated.toLocaleString()}
                      </span>
                    </div>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div 
                      className="bg-blue-500 h-3 rounded-full relative"
                      style={{width: `${percentage}%`}}
                    >
                      {data.actual > 0 && (
                        <div 
                          className="bg-green-500 h-3 rounded-full absolute top-0 left-0"
                          style={{width: `${spentPercentage}%`}}
                        />
                      )}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* Quick Stats */}
        <div className="grid md:grid-cols-3 gap-4">
          <div className="bg-white rounded-lg p-4 shadow">
            <h4 className="font-semibold text-gray-800 mb-2">Hotels Planned</h4>
            <p className="text-2xl font-bold text-blue-600">{tripData.hotels.length}</p>
            <p className="text-sm text-gray-600">{tripData.hotels.filter(h => h.bookingStatus === 'Confirmed').length} confirmed</p>
          </div>
          <div className="bg-white rounded-lg p-4 shadow">
            <h4 className="font-semibold text-gray-800 mb-2">Restaurants Listed</h4>
            <p className="text-2xl font-bold text-green-600">{tripData.restaurants.length}</p>
            <p className="text-sm text-gray-600">{tripData.restaurants.filter(r => r.priority === 'High').length} high priority</p>
          </div>
          <div className="bg-white rounded-lg p-4 shadow">
            <h4 className="font-semibold text-gray-800 mb-2">Days Planned</h4>
            <p className="text-2xl font-bold text-purple-600">{tripData.itinerary.length}</p>
            <p className="text-sm text-gray-600">Out of {days} total days</p>
          </div>
        </div>
      </div>
    );
  };

  // Settings Component  
  const renderSettings = () => {
    const updateTripOverview = (field, value) => {
      setTripData(prev => ({
        ...prev,
        overview: { ...prev.overview, [field]: value }
      }));
    };

    const updateBudget = (category, type, value) => {
      setTripData(prev => ({
        ...prev,
        budget: {
          ...prev.budget,
          [category]: { ...prev.budget[category], [type]: parseInt(value) || 0 }
        }
      }));
    };

    return (
      <div className="space-y-6">
        {/* Trip Overview Settings */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Trip Overview</h3>
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Destination</label>
              <input
                type="text"
                value={tripData.overview.destination}
                onChange={(e) => updateTripOverview('destination', e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Number of Travelers</label>
              <input
                type="number"
                value={tripData.overview.travelers}
                onChange={(e) => updateTripOverview('travelers', parseInt(e.target.value))}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
              <input
                type="date"
                value={tripData.overview.startDate}
                onChange={(e) => updateTripOverview('startDate', e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">End Date</label>
              <input
                type="date"
                value={tripData.overview.endDate}
                onChange={(e) => updateTripOverview('endDate', e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>
        </div>

        {/* Budget Settings */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Budget Planning</h3>
          <div className="space-y-4">
            {Object.entries(tripData.budget).map(([category, data]) => (
              <div key={category} className="grid md:grid-cols-3 gap-4 items-center p-4 bg-gray-50 rounded-lg">
                <div>
                  <h4 className="font-medium capitalize text-gray-800">{category}</h4>
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Estimated Budget</label>
                  <input
                    type="number"
                    value={data.estimated}
                    onChange={(e) => updateBudget(category, 'estimated', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                    placeholder="‚Çπ0"
                  />
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Actual Spent</label>
                  <input
                    type="number"
                    value={data.actual}
                    onChange={(e) => updateBudget(category, 'actual', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                    placeholder="‚Çπ0"
                  />
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // Hotels Management
  const renderHotels = () => {
    const addHotel = () => {
      const newHotel = {
        id: Date.now(),
        name: "New Hotel",
        location: "",
        category: "Mid-range", 
        pricePerNight: 0,
        nights: 1,
        checkIn: tripData.overview.startDate,
        checkOut: tripData.overview.endDate,
        bookingStatus: "Not booked",
        features: ""
      };
      setTripData(prev => ({
        ...prev,
        hotels: [...prev.hotels, newHotel]
      }));
    };

    const updateHotel = (id, field, value) => {
      setTripData(prev => ({
        ...prev,
        hotels: prev.hotels.map(hotel => 
          hotel.id === id ? { ...hotel, [field]: value } : hotel
        )
      }));
    };

    const deleteHotel = (id) => {
      setTripData(prev => ({
        ...prev,
        hotels: prev.hotels.filter(hotel => hotel.id !== id)
      }));
    };

    return (
      <div className="space-y-4">
        <div className="flex justify-between items-center">
          <h3 className="text-xl font-bold text-gray-800">Hotel Options</h3>
          <button
            onClick={addHotel}
            className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center"
          >
            <Plus className="w-4 h-4 mr-2" />
            Add Hotel
          </button>
        </div>

        {tripData.hotels.map((hotel) => (
          <div key={hotel.id} className="bg-white rounded-lg border shadow-sm p-6">
            <div className="flex justify-between items-start mb-4">
              <input
                type="text"
                value={hotel.name}
                onChange={(e) => updateHotel(hotel.id, 'name', e.target.value)}
                className="text-lg font-semibold text-gray-800 bg-transparent border-b border-gray-300 focus:border-blue-500 outline-none"
              />
              <button
                onClick={() => deleteHotel(hotel.id)}
                className="text-red-500 hover:text-red-700"
              >
                <Trash2 className="w-4 h-4" />
              </button>
            </div>
            
            <div className="grid md:grid-cols-3 gap-4">
              <div>
                <label className="block text-xs text-gray-600 mb-1">Location</label>
                <input
                  type="text"
                  value={hotel.location}
                  onChange={(e) => updateHotel(hotel.id, 'location', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Category</label>
                <select
                  value={hotel.category}
                  onChange={(e) => updateHotel(hotel.id, 'category', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                >
                  <option>Budget</option>
                  <option>Mid-range</option>
                  <option>Premium</option>
                  <option>Luxury</option>
                </select>
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Price per Night</label>
                <input
                  type="number"
                  value={hotel.pricePerNight}
                  onChange={(e) => updateHotel(hotel.id, 'pricePerNight', parseInt(e.target.value))}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Check-in</label>
                <input
                  type="date"
                  value={hotel.checkIn}
                  onChange={(e) => updateHotel(hotel.id, 'checkIn', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Check-out</label>
                <input
                  type="date"
                  value={hotel.checkOut}
                  onChange={(e) => updateHotel(hotel.id, 'checkOut', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                />
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Booking Status</label>
                <select
                  value={hotel.bookingStatus}
                  onChange={(e) => updateHotel(hotel.id, 'bookingStatus', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                >
                  <option>Not booked</option>
                  <option>Pending</option>
                  <option>Confirmed</option>
                  <option>Cancelled</option>
                </select>
              </div>
            </div>
            
            <div className="mt-4">
              <label className="block text-xs text-gray-600 mb-1">Features</label>
              <input
                type="text"
                value={hotel.features}
                onChange={(e) => updateHotel(hotel.id, 'features', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"
                placeholder="e.g., Lake views, spa, restaurant..."
              />
            </div>

            <div className="mt-4 p-3 bg-gray-50 rounded">
              <p className="text-sm text-gray-600">
                Total Cost: <span className="font-semibold">{tripData.overview.currency}{(hotel.pricePerNight * hotel.nights).toLocaleString()}</span>
                {hotel.nights > 0 && <span className="ml-2 text-xs">({hotel.nights} nights)</span>}
              </p>
            </div>
          </div>
        ))}
      </div>
    );
  };

  const tabs = [
    { id: 'dashboard', label: 'Dashboard', icon: <PieChart className="w-4 h-4" /> },
    { id: 'settings', label: 'Trip Settings', icon: <Info className="w-4 h-4" /> },
    { id: 'hotels', label: 'Hotels', icon: <Hotel className="w-4 h-4" /> },
    { id: 'restaurants', label: 'Restaurants', icon: <Star className="w-4 h-4" /> },
    { id: 'itinerary', label: 'Itinerary', icon: <Calendar className="w-4 h-4" /> },
    { id: 'transport', label: 'Transport', icon: <Car className="w-4 h-4" /> },
  ];

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
          <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white p-6">
            <div className="flex justify-between items-start">
              <div>
                <h1 className="text-3xl font-bold">üåç Trip Planner Dashboard</h1>
                <p className="text-green-100 mt-2">{tripData.overview.destination}</p>
                <p className="text-green-200 text-sm">
                  {new Date(tripData.overview.startDate).toLocaleDateString()} - {new Date(tripData.overview.endDate).toLocaleDateString()}
                  <span className="ml-4">{tripData.overview.travelers} travelers</span>
                </p>
              </div>
              <div className="text-right">
                <div className="text-green-100 text-sm">Total Budget</div>
                <div className="text-2xl font-bold">{tripData.overview.currency}{calculateTotalBudget().toLocaleString()}</div>
              </div>
            </div>
          </div>
          
          {/* Navigation Tabs */}
          <div className="border-b">
            <div className="flex space-x-0 overflow-x-auto">
              {tabs.map((tab) => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center space-x-2 px-4 py-4 font-medium transition-colors whitespace-nowrap ${
                    activeTab === tab.id
                      ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                  }`}
                >
                  {tab.icon}
                  <span>{tab.label}</span>
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Content */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          {activeTab === 'dashboard' && renderDashboard()}
          {activeTab === 'settings' && renderSettings()}
          {activeTab === 'hotels' && renderHotels()}
          {activeTab === 'restaurants' && <div className="text-center p-8 text-gray-500">Restaurant management coming soon...</div>}
          {activeTab === 'itinerary' && <div className="text-center p-8 text-gray-500">Itinerary editor coming soon...</div>}
          {activeTab === 'transport' && <div className="text-center p-8 text-gray-500">Transport planner coming soon...</div>}
        </div>

        {/* Footer */}
        <div className="mt-6 text-center text-gray-500 text-sm">
          <p>‚ú® All data saved locally in your browser ‚Ä¢ Free to use and host on GitHub Pages</p>
        </div>
      </div>
    </div>
  );
};

export default MeghalayaTripPlanner;
